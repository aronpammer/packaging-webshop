<!DOCTYPE html>
<html lang="en">
<head>
    <% title = page.title; %>
    <% metaDescription = page.metaDescription || page.title; %>
    <%- include('partials/head') %>
    <style>
    .contact-page {
        padding: 40px 0;
    }
    .contact-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-top: 30px;
    }
    @media (max-width: 768px) {
        .contact-grid {
            grid-template-columns: 1fr;
            gap: 30px;
        }
    }
    .contact-info {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
        border-left: 4px solid #007bff;
    }
    .contact-info h3 {
        color: #007bff;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    .contact-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .contact-item i {
        color: #007bff;
        margin-right: 15px;
        width: 20px;
        text-align: center;
    }
    .contact-form-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .contact-form-section h3 {
        color: #007bff;
        margin-bottom: 20px;
        font-size: 1.5rem;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }
    .form-control {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }
    .form-control:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    textarea.form-control {
        resize: vertical;
        min-height: 120px;
    }
    .btn-submit {
        background: #007bff;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease;
        width: 100%;
    }
    .btn-submit:hover {
        background: #0056b3;
    }
    .map-section {
        margin-top: 40px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .map-header {
        padding: 20px 30px;
        background: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
    }
    .map-header h3 {
        margin: 0;
        color: #007bff;
        font-size: 1.5rem;
    }
    .map-container {
        position: relative;
        height: 400px;
        background: #e9ecef;
    }
    #map {
        width: 100%;
        height: 100%;
    }
    .map-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #6c757d;
        font-size: 18px;
    }
    .success-message {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
    }
    .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
    }
    </style>
</head>
<body>
    <%- include('partials/header') %>

    <main>
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <p><a href="/"><%= siteSettings.homeText %></a> / <%= page.title %></p>
        </div>
    </div>

    <!-- Contact Page Content -->
    <section class="contact-page">
        <div class="container">
            <h1><%= page.title %></h1>

            <% if (page.content) { %>
            <div class="page-content">
                <%- page.content %>
            </div>
            <% } %>

            <div class="contact-grid">
                <!-- Contact Information -->
                <div class="contact-info">
                    <h3><%= siteSettings.footerContactTitle %></h3>

                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <strong><%= siteSettings.phoneText %></strong><br>
                            <a href="tel:<%= siteSettings.phone %>"><%= siteSettings.phone %></a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <strong><%= siteSettings.emailText %></strong><br>
                            <a href="mailto:<%= siteSettings.email %>"><%= siteSettings.email %></a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <strong><%= siteSettings.hoursText %></strong><br>
                            <%= siteSettings.businessHours %>
                        </div>
                    </div>

                    <% if (siteSettings.address) { %>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <strong>Cím</strong><br>
                            <%= siteSettings.address %>
                        </div>
                    </div>
                    <% } %>
                </div>

                <!-- Contact Form -->
                <div class="contact-form-section">
                    <h3>Írjon nekünk</h3>

                    <div class="success-message" id="success-message">
                        Köszönjük üzenetét! Hamarosan felvesszük Önnel a kapcsolatot.
                    </div>

                    <div class="error-message" id="error-message">
                        Hiba történt az üzenet küldése során. Kérjük, próbálja meg később.
                    </div>

                    <form id="contact-form">
                        <div class="form-group">
                            <label for="name">Név *</label>
                            <input type="text" id="name" name="name" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email cím *</label>
                            <input type="email" id="email" name="email" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Telefonszám</label>
                            <input type="tel" id="phone" name="phone" class="form-control">
                        </div>

                        <div class="form-group">
                            <label for="subject">Tárgy *</label>
                            <input type="text" id="subject" name="subject" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="message">Üzenet *</label>
                            <textarea id="message" name="message" class="form-control" required placeholder="Írja ide üzenetét..."></textarea>
                        </div>

                        <button type="submit" class="btn-submit">Üzenet küldése</button>
                    </form>
                </div>
            </div>

            <!-- Map Section -->
            <div class="map-section">
                <div class="map-header">
                    <h3>Elhelyezkedés</h3>
                </div>
                <div class="map-container">
                    <div id="map">
                        <div class="map-placeholder">
                            <div>
                                <i class="fas fa-map-marker-alt" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                                Térkép betöltése...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </main>

    <%- include('partials/footer') %>

    <script>
    // Contact form handling
    document.getElementById('contact-form').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData);

        const submitButton = this.querySelector('.btn-submit');
        const originalText = submitButton.textContent;
        submitButton.textContent = 'Küldés...';
        submitButton.disabled = true;

        try {
            const response = await fetch('/contact/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                document.getElementById('success-message').style.display = 'block';
                document.getElementById('error-message').style.display = 'none';
                this.reset();
            } else {
                throw new Error('Server error');
            }
        } catch (error) {
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
        }

        submitButton.textContent = originalText;
        submitButton.disabled = false;
    });

    // Initialize map (Google Maps)
    function initMap() {
        // Default coordinates (Budapest, Hungary) - you can change this to your warehouse address
        const defaultLocation = { lat: 47.4979, lng: 19.0402 };

        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: defaultLocation,
            styles: [
                {
                    featureType: 'all',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#f5f5f5' }]
                },
                {
                    featureType: 'water',
                    elementType: 'geometry.fill',
                    stylers: [{ color: '#c9e7ff' }]
                }
            ]
        });

        const marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            title: '<%= siteSettings.companyName %>',
            icon: {
                url: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMwMDdiZmYiLz4KPHA/d2VhciBjb2xvcj0id2hpdGUiIGZpbGw9IiNmZmZmZmYiIGQ9Im0yMCw5IGMtNS41LDAgLTEwLDQuNSAtMTAsOnYgMCwzLjUgNCw2LjUgMTAsdhEgNiwtNC41IDEwLC02LjUgeiIvPgo8L3N2Zz4K',
                scaledSize: new google.maps.Size(40, 40)
            }
        });

        const infoWindow = new google.maps.InfoWindow({
            content: \`
                <div style="padding: 10px;">
                    <h4><%= siteSettings.companyName %></h4>
                    <p><%= siteSettings.address %></p>
                    <p><%= siteSettings.phone %></p>
                    <p><%= siteSettings.email %></p>
                </div>
            \`
        });

        marker.addListener('click', () => {
            infoWindow.open(map, marker);
        });
    }

    // Load Google Maps API
    function loadGoogleMaps() {
        // You would need to add your Google Maps API key here
        // For now, we'll show a placeholder
        const mapElement = document.getElementById('map');
        mapElement.innerHTML = \`
            <div class="map-placeholder">
                <div style="text-align: center;">
                    <i class="fas fa-map-marker-alt" style="font-size: 3rem; color: #007bff; margin-bottom: 15px;"></i><br>
                    <strong><%= siteSettings.companyName %></strong><br>
                    <%= siteSettings.address %><br><br>
                    <small>A térkép megjelenítéséhez Google Maps API kulcs szükséges</small>
                </div>
            </div>
        \`;
    }

    // Initialize map when page loads
    document.addEventListener('DOMContentLoaded', loadGoogleMaps);
    </script>
</body>
</html>